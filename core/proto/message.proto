syntax = "proto3";

package message;

enum Type {
    CORT = 0; //连接初始化，携带令牌
    CORS = 1;
    CHRT = 2;
    CHRS = 3;
    PING = 6;//心跳消息
    PONG = 7;
}

message Message{
    uint64 id = 1;     //消息id
    uint64 ts = 2;     //时间戳(单位:毫秒)
    Type mtype = 3;  //消息类型
    oneof content {
        Cort cort = 4;
        Cors cors = 5;
        Chrt chrt = 6;
        Chrs chrs = 7;
        Ping ping = 8;
        Pong pong = 9;
    } //消息内容
}

//ConnectRequest
message Cort{
    string token = 1;
}

//ConnectResponse
message Cors{
    uint32 code = 1;
    string message = 2;
    uint64 uid = 3;
    string uname = 4;
}

//ChatRequest
message Chrt {
    uint64 sender = 1;
    string uname = 2; //发送者昵称
    uint64 session = 3; //所发生的聊天室会话id
    repeated uint64 receivers = 4;
    ChatType ctype = 5;
    uint64 ts = 6;
    oneof message {
        Text text = 7;
        Blob blob = 8;
    }
}

//ChatResponse
message Chrs {
    uint64 sender = 1;
    string uname = 2; //发送者昵称
    uint64 session = 3; //所发生的聊天室会话id
    uint64 receiver = 4;
    ChatType ctype = 5;
    uint64 ts = 6;
    oneof message {
        Text text = 7;
        Blob blob = 8;
    }
}

//普通文本消息
message Text{
    string text = 1;
}

//文件消息
message Blob{
    uint64 id = 1;
    string name = 2;
    string size = 3;
    string exp = 4;
}

message Ping {
    uint64 ts = 1;
}

message Pong {
    uint64 ts = 1;
    uint64 latency = 2;
}


message Session {
    uint64 id = 1;
    bool unread = 2;
    //repeated Chat chats = 3;
}

message Pull {
    message Request {
        // 是否全部拉取，包括消息内容
        // false = 只拉取每个聊天室是否有未读的消息
        // true = 拉取指定聊天室中未读取的所有消息
      bool full = 1;
      // 指定拉取的聊天室id
      uint64 session = 2;
    }
    message Response {
        repeated Session sessions = 1;
    }
    Request request = 1;
    Response response = 2;
}

message Push {
  //Chat chat = 1;
}

enum ChatType {
    /** 文本 */
    TEXT = 0;
    /** 表情 */
    EMOJI = 1;
    /** 图片 */
    IMAGE = 2;
    /** 代码 */
    CODE = 3;
    /** 富文本 */
    RTF = 4;
    /** 文件 */
    FILE = 5;
}

//不需要内容的消息
message None {}

message Error {
    int32 code = 1;
    string message = 2;
}